Description: fix build with miniupnpc 2.0.x
Bug-Debian: http://bugs.debian.org/890507
Applied-Upstream: 2.4.0
Last-Update: 2018-02-16


--- a/extra/upnpc.cpp
+++ b/extra/upnpc.cpp
@@ -41,9 +42,13 @@
 
 bool UPnPc::init()
 {
-    UPNPDev *devices = upnpDiscover(5000, SettingsManager::getInstance()->isDefault(SettingsManager::BIND_ADDRESS) ? 0 : SETTING(BIND_ADDRESS).c_str(), 0, 0
-#if (MINIUPNPC_API_VERSION == 8 || defined(MINIUPNPC16))
-                                        , 0, 0);
+    UPNPDev *devices = upnpDiscover(5000, SettingsManager::getInstance()->isDefault(SettingsManager::BIND_ADDRESS) ? 0 : SETTING(BIND_ADDRESS).c_str(), NULL, 0
+#if (MINIUPNPC_API_VERSION >= 8 || defined(MINIUPNPC16))
+                                        , 0
+#if (MINIUPNPC_API_VERSION >= 14)
+                                        , 2
+#endif
+                                        , NULL);
 #else
                                         );
 #endif
@@ -63,8 +68,8 @@
     const string port_ = Util::toString(port);
 
     return UPNP_AddPortMapping(urls.controlURL, data.first.servicetype, port_.c_str(), port_.c_str(),
-        Util::getLocalIp().c_str(), description.c_str(), protocols[protocol], NULL
-#if (MINIUPNPC_API_VERSION == 8 || defined(MINIUPNPC16))
+        Util::getLocalIp().c_str(), description.c_str(), protocols[protocol], NULL
+#if (MINIUPNPC_API_VERSION >= 8 || defined(MINIUPNPC16))
                                                                                     , 0) == UPNPCOMMAND_SUCCESS;
 #else
                                                                                     ) == UPNPCOMMAND_SUCCESS;
